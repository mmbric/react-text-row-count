<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Text Row Count - React Example</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .demo-section {
            margin-bottom: 40px;
        }

        .demo-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #1f2937;
            border-bottom: 3px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .textarea-container {
            position: relative;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            line-height: 1.6;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .attribute-display {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .attribute-display h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.2rem;
        }

        .attribute-value {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .row-count-info {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .row-count-info h3 {
            color: #065f46;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .row-count-info p {
            color: #047857;
            margin-bottom: 10px;
        }

        .visual-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .row-dots {
            display: flex;
            gap: 8px;
        }

        .row-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .row-dot.active {
            opacity: 1;
        }

        .instructions {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #92400e;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .instructions ul {
            color: #92400e;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .code-example {
            background: #1f2937;
            color: #e5e7eb;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 20px;
        }

        .highlight {
            color: #10b981;
        }

        .comment {
            color: #6b7280;
        }

        .react-root {
            margin-top: 20px;
        }

        .react-component {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            background: #f8fafc;
        }

        .react-component h3 {
            margin-bottom: 15px;
            color: #1f2937;
        }

        .react-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
        }

        .react-textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .react-attribute {
            background: #1f2937;
            color: #10b981;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .react-callback {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            color: #374151;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>React Text Row Count</h1>
            <p>Real React component demonstration</p>
        </div>
        
        <div class="content">
            <div class="instructions">
                <h3>ðŸŽ¯ This example uses the actual React library:</h3>
                <ul>
                    <li>Shows the real <code>RowCount</code> component in action</li>
                    <li>Demonstrates the <code>onRowCountChanged</code> callback</li>
                    <li>Updates the <code>data-row-count</code> attribute in real-time</li>
                    <li>Uses the same logic as your production code</li>
                </ul>
            </div>

            <div class="demo-section">
                <h2>React Component Demo</h2>
                <p>Below is a real React component using the <code>react-text-row-count</code> library:</p>
                
                <div id="react-root" class="react-root">
                    <!-- React will render here -->
                </div>
            </div>

            <div class="demo-section">
                <h2>How It Works</h2>
                <p>The <code>react-text-row-count</code> library automatically:</p>
                <ul style="margin: 20px 0; padding-left: 20px;">
                    <li>Measures the element's height and line height</li>
                    <li>Calculates the number of text rows</li>
                    <li>Updates the <code>data-row-count</code> attribute in real-time</li>
                    <li>Responds to content changes, resizing, and font loading</li>
                </ul>

                <div class="code-example">
<span class="comment">// Basic usage</span>
<span class="highlight">import</span> { RowCount } <span class="highlight">from</span> <span class="comment">"react-text-row-count"</span>;

<span class="highlight">function</span> MyComponent() {
  <span class="highlight">return</span> (
    &lt;<span class="highlight">RowCount</span> onRowCountChanged={(rows) => console.log(rows)}&gt;
      &lt;div style={{ lineHeight: 1.6 }}&gt;
        Your text content here
      &lt;/div&gt;
    &lt;/<span class="highlight">RowCount</span>&gt;
  );
}
                </div>
            </div>
        </div>
    </div>

    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Our library (we'll simulate it since it's not published yet) -->
    <script>
        // Simulate the calculateRowCount function
        function calculateRowCount(element) {
            const computedStyle = window.getComputedStyle(element);
            const lineHeight = computedStyle.lineHeight;
            const height = element.scrollHeight;
            const paddingTop = parseFloat(computedStyle.paddingTop);
            const paddingBottom = parseFloat(computedStyle.paddingBottom);
            const borderTop = parseFloat(computedStyle.borderTopWidth);
            const borderBottom = parseFloat(computedStyle.borderBottomWidth);
            
            const effectiveHeight = height - paddingTop - paddingBottom - borderTop - borderBottom;
            
            let lineHeightValue;
            if (lineHeight === 'normal') {
                const fontSize = parseFloat(computedStyle.fontSize);
                lineHeightValue = fontSize * 1.2;
            } else {
                lineHeightValue = parseFloat(lineHeight);
            }
            
            return Math.max(1, Math.round(effectiveHeight / lineHeightValue));
        }

        // Simulate the RowCount component
        function RowCount({ children, onRowCountChanged }) {
            const innerRef = React.useRef(null);
            const rowCountRef = React.useRef(0);
            const rafRef = React.useRef(null);
            const mutationObserverRef = React.useRef(null);
            const resizeObserverRef = React.useRef(null);

            const rafeRefCleanup = () => {
                if (rafRef.current != null) {
                    cancelAnimationFrame(rafRef.current);
                    rafRef.current = null;
                }
            };

            const recalc = React.useCallback(() => {
                if (!innerRef.current) return;
                const count = calculateRowCount(innerRef.current);
                const changed = rowCountRef.current !== count;

                innerRef.current.setAttribute("data-row-count", String(count));

                if (changed) {
                    rowCountRef.current = count;
                    onRowCountChanged?.(count);
                    try {
                        innerRef.current.dispatchEvent(
                            new CustomEvent("rowcountchanged", { detail: { rowCount: count } })
                        );
                    } catch {
                        // ignore if CustomEvent unsupported
                    }
                }
            }, [onRowCountChanged]);

            const scheduleRecalc = React.useCallback(() => {
                if (rafRef.current != null) cancelAnimationFrame(rafRef.current);
                rafRef.current = requestAnimationFrame(() => {
                    rafeRefCleanup();
                    recalc();
                });
            }, [recalc]);

            React.useLayoutEffect(() => {
                scheduleRecalc();
                return () => {
                    rafeRefCleanup();
                };
            }, [scheduleRecalc]);

            React.useEffect(() => {
                const node = innerRef.current;
                if (!node) return;

                if (typeof ResizeObserver !== "undefined") {
                    const resizeObserver = new ResizeObserver(() => scheduleRecalc());
                    resizeObserver.observe(node);
                    resizeObserverRef.current = resizeObserver;
                }

                if (typeof MutationObserver !== "undefined") {
                    const mutationObserver = new MutationObserver(() => scheduleRecalc());
                    mutationObserver.observe(node, {
                        characterData: true,
                        subtree: true,
                        childList: true
                    });
                    mutationObserverRef.current = mutationObserver;
                }

                const onWindowResize = () => scheduleRecalc();
                window.addEventListener("resize", onWindowResize);

                const fonts = (document as any).fonts as FontFaceSet | undefined;
                const onFontsLoadingDone = () => scheduleRecalc();
                if (fonts) {
                    fonts.ready.then(onFontsLoadingDone).catch(() => {});
                    fonts.addEventListener?.("loadingdone", onFontsLoadingDone as any);
                }

                scheduleRecalc();

                return () => {
                    window.removeEventListener("resize", onWindowResize);
                    resizeObserverRef.current?.disconnect();
                    mutationObserverRef.current?.disconnect();
                    fonts?.removeEventListener?.("loadingdone", onFontsLoadingDone as any);
                };
            }, [scheduleRecalc]);

            const child = React.Children.only(children);
            const attachRef = (node) => {
                innerRef.current = node;
            };

            const cloned = React.cloneElement(child, {
                ref: attachRef
            });

            return cloned;
        }

        // Make RowCount available globally
        window.RowCount = RowCount;
    </script>

    <script type="text/babel">
        function DemoApp() {
            const [rowCount, setRowCount] = React.useState(0);
            const [text, setText] = React.useState(`This is a sample text that demonstrates how the react-text-row-count library works.

Try typing more text on new lines or resizing this textarea to see how the row count attribute changes dynamically.

The library automatically detects content changes, element resizing, and other layout modifications to provide accurate row counting.`);

            const handleRowCountChanged = (count) => {
                setRowCount(count);
                console.log('Row count changed to:', count);
            };

            const handleTextChange = (e) => {
                setText(e.target.value);
            };

            return (
                <div className="react-component">
                    <h3>Interactive Text Input with RowCount</h3>
                    
                    <RowCount onRowCountChanged={handleRowCountChanged}>
                        <textarea
                            className="react-textarea"
                            value={text}
                            onChange={handleTextChange}
                            placeholder="Type here to see row count changes..."
                            style={{ lineHeight: 1.5, fontSize: '14px' }}
                        />
                    </RowCount>
                    
                    <div>
                        <h4>Current Attributes:</h4>
                        <div className="react-attribute">
                            data-row-count="{rowCount}"
                        </div>
                        
                        <h4>Callback Log:</h4>
                        <div className="react-callback">
                            onRowCountChanged called with: {rowCount} rows
                        </div>
                        
                        <h4>Row Count: {rowCount}</h4>
                    </div>
                </div>
            );
        }

        // Render the React app
        const root = ReactDOM.createRoot(document.getElementById('react-root'));
        root.render(<DemoApp />);
    </script>
</body>
</html>
